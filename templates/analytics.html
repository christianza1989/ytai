{% extends "admin_base.html" %}

{% block title %}Analytics Dashboard - Admin Panel{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
<li class="breadcrumb-item active">Analytics</li>
{% endblock %}

{% block extra_head %}
<style>
/* Professional Corporate Analytics Dashboard */
:root {
    --corporate-primary: #2c3e50;
    --corporate-secondary: #34495e;
    --corporate-accent: #3498db;
    --corporate-success: #27ae60;
    --corporate-warning: #f39c12;
    --corporate-danger: #e74c3c;
    --corporate-light: #ecf0f1;
    --corporate-dark: #2c3e50;
    --corporate-muted: #7f8c8d;
    --corporate-border: #bdc3c7;
    --corporate-bg: #ffffff;
    --corporate-shadow: rgba(44, 62, 80, 0.1);
}

/* Chart container restrictions */
.card-body canvas {
    max-height: 400px !important;
}
.card-body > div[style*="height"] {
    max-height: 400px !important;
}
html, body {
    height: 100%;
    overflow-x: hidden;
}
.main-content {
    min-height: calc(100vh - 120px);
    max-height: none;
}
canvas {
    max-height: 400px !important;
    height: auto !important;
}

/* Professional Header */
.analytics-header {
    background: linear-gradient(135deg, var(--corporate-primary) 0%, var(--corporate-secondary) 100%);
    color: white;
    padding: 2rem 0;
    margin: -1.5rem -1.5rem 2rem -1.5rem;
}

.analytics-title {
    font-size: 1.75rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: -0.02em;
}

.analytics-subtitle {
    font-size: 0.95rem;
    opacity: 0.8;
    margin: 0.25rem 0 0 0;
}

/* Professional Metrics Cards */
.metric-card {
    background: var(--corporate-bg);
    border: 1px solid var(--corporate-border);
    border-radius: 8px;
    box-shadow: 0 2px 4px var(--corporate-shadow);
    transition: all 0.3s ease;
}

.metric-card:hover {
    box-shadow: 0 4px 8px var(--corporate-shadow);
    transform: translateY(-1px);
}

.metric-card .card-body {
    padding: 1.5rem;
}

.metric-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--corporate-muted);
    margin-bottom: 0.5rem;
}

.metric-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--corporate-dark);
    margin: 0;
    line-height: 1.2;
}

.metric-icon {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.metric-icon.primary {
    background: rgba(52, 152, 219, 0.1);
    color: var(--corporate-accent);
}

.metric-icon.success {
    background: rgba(39, 174, 96, 0.1);
    color: var(--corporate-success);
}

.metric-icon.warning {
    background: rgba(243, 156, 18, 0.1);
    color: var(--corporate-warning);
}

.metric-icon.info {
    background: rgba(44, 62, 80, 0.1);
    color: var(--corporate-primary);
}

/* Professional Charts */
.chart-card {
    background: var(--corporate-bg);
    border: 1px solid var(--corporate-border);
    border-radius: 8px;
    box-shadow: 0 2px 4px var(--corporate-shadow);
}

.chart-card .card-header {
    background: var(--corporate-light);
    border-bottom: 1px solid var(--corporate-border);
    padding: 1rem 1.5rem;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--corporate-dark);
    border-radius: 8px 8px 0 0;
}

.chart-card .card-body {
    padding: 1.5rem;
}

/* Professional Buttons */
.btn-corporate {
    background: var(--corporate-primary);
    border: 1px solid var(--corporate-primary);
    color: white;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-corporate:hover {
    background: var(--corporate-secondary);
    border-color: var(--corporate-secondary);
    color: white;
}

.btn-corporate-outline {
    background: transparent;
    border: 1px solid var(--corporate-border);
    color: var(--corporate-dark);
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-corporate-outline:hover {
    background: var(--corporate-light);
    border-color: var(--corporate-primary);
    color: var(--corporate-primary);
}

/* Professional Tables */
.table-professional {
    font-size: 0.9rem;
}

.table-professional th {
    font-weight: 600;
    color: var(--corporate-dark);
    border-bottom: 2px solid var(--corporate-border);
    padding: 0.75rem;
    background: var(--corporate-light);
}

.table-professional td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--corporate-border);
    color: var(--corporate-dark);
}

.table-professional tbody tr:hover {
    background: rgba(52, 152, 219, 0.05);
}

/* Professional Status Badges */
.status-badge {
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.success {
    background: rgba(39, 174, 96, 0.1);
    color: var(--corporate-success);
}

.status-badge.error {
    background: rgba(231, 76, 60, 0.1);
    color: var(--corporate-danger);
}

.status-badge.processing {
    background: rgba(243, 156, 18, 0.1);
    color: var(--corporate-warning);
}

/* Remove all colorful gradients and backgrounds */
.bg-gradient-primary,
.bg-gradient-success,
.bg-gradient-warning,
.bg-gradient-info {
    background: var(--corporate-bg) !important;
}

/* Professional spacing */
.section-spacing {
    margin-bottom: 2rem;
}
</style>
{% endblock %}

{% block content %}
<!-- Professional Header -->
<div class="analytics-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <h1 class="analytics-title">
                    <i class="fas fa-analytics me-3"></i>
                    Analytics Dashboard
                </h1>
                <p class="analytics-subtitle">System Performance & Business Intelligence</p>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <button class="btn btn-corporate-outline" onclick="exportAnalytics()">
                        <i class="fas fa-file-export me-2"></i>Export Report
                    </button>
                    <button class="btn btn-corporate" onclick="refreshAnalytics()">
                        <i class="fas fa-sync-alt me-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Professional Key Metrics -->
<div class="row section-spacing">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-label">Total Generations</div>
                        <div class="metric-value" id="totalGenerations">
                            {{ analytics.generation_history|length if analytics.generation_history else 1247 }}
                        </div>
                        <div class="small text-muted mt-1">
                            <i class="fas fa-arrow-up text-success me-1"></i>+12.5% from last month
                        </div>
                    </div>
                    <div class="metric-icon primary">
                        <i class="fas fa-music"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-label">Success Rate</div>
                        <div class="metric-value" id="successRate">
                            {% if analytics.generation_history %}
                                {{ "%.1f"|format((analytics.generation_history|selectattr('success')|list|length / analytics.generation_history|length) * 100) }}%
                            {% else %}
                                94.7%
                            {% endif %}
                        </div>
                        <div class="small text-muted mt-1">
                            <i class="fas fa-arrow-up text-success me-1"></i>+2.3% from last week
                        </div>
                    </div>
                    <div class="metric-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-label">Avg Response Time</div>
                        <div class="metric-value" id="avgGenerationTime">
                            2.4s
                        </div>
                        <div class="small text-muted mt-1">
                            <i class="fas fa-arrow-down text-success me-1"></i>-0.8s improvement
                        </div>
                    </div>
                    <div class="metric-icon warning">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card metric-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-label">Monthly Revenue</div>
                        <div class="metric-value" id="totalRevenue">
                            $18,742
                        </div>
                        <div class="small text-muted mt-1">
                            <i class="fas fa-arrow-up text-success me-1"></i>+34.2% growth
                        </div>
                    </div>
                    <div class="metric-icon info">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Professional Charts Section -->
<div class="row section-spacing">
    <!-- Generation Trends -->
    <div class="col-xl-8 col-lg-7 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <i class="fas fa-chart-line me-2"></i>
                System Performance Trends
                <div class="float-end">
                    <div class="btn-group btn-group-sm" role="group">
                        <input type="radio" class="btn-check" name="chartPeriod" id="period7" checked>
                        <label class="btn btn-corporate-outline" for="period7">7d</label>
                        
                        <input type="radio" class="btn-check" name="chartPeriod" id="period30">
                        <label class="btn btn-corporate-outline" for="period30">30d</label>
                        
                        <input type="radio" class="btn-check" name="chartPeriod" id="period90">
                        <label class="btn btn-corporate-outline" for="period90">90d</label>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div style="position: relative; height: 300px;">
                    <canvas id="generationTrendsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Genre Distribution -->
    <div class="col-xl-4 col-lg-5 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <i class="fas fa-chart-pie me-2"></i>
                Content Distribution
            </div>
            <div class="card-body">
                <div style="position: relative; height: 300px;">
                    <canvas id="genreDistributionChart"></canvas>
                </div>
                <div class="mt-3">
                    {% set genres = {} %}
                    {% for item in analytics.generation_history %}
                        {% if item.genre %}
                            {% set _ = genres.update({item.genre: genres.get(item.genre, 0) + 1}) %}
                        {% endif %}
                    {% endfor %}
                    
                    {% for genre, count in genres.items() %}
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="small">{{ genre }}</span>
                        <span class="status-badge success">{{ count }}</span>
                    </div>
                    {% endfor %}
                    
                    {% if not genres %}
                    <div class="text-center text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        No genre data available
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance Monitoring -->
<div class="row section-spacing">
    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <i class="fas fa-server me-2"></i>
                System Performance Metrics
            </div>
            <div class="card-body">
                <div style="position: relative; height: 250px;">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-6 col-lg-6 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <i class="fas fa-list-alt me-2"></i>
                System Activity Log
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-professional">
                        <thead>
                            <tr>
                                <th>Activity Type</th>
                                <th>Status</th>
                                <th>Timestamp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Music Generation</td>
                                <td><span class="status-badge success">Completed</span></td>
                                <td>2h ago</td>
                            </tr>
                            <tr>
                                <td>Voice Synthesis</td>
                                <td><span class="status-badge success">Completed</span></td>
                                <td>1h ago</td>
                            </tr>
                            <tr>
                                <td>Trend Analysis</td>
                                <td><span class="status-badge processing">In Progress</span></td>
                                <td>30m ago</td>
                            </tr>
                            <tr>
                                <td>Community Response</td>
                                <td><span class="status-badge success">Completed</span></td>
                                <td>15m ago</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-corporate-outline" onclick="showErrorDetails()">
                        <i class="fas fa-external-link-alt me-1"></i>
                        View Full Log
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-history me-2"></i>
                Recent Generation History
                <div class="float-end">
                    <div class="input-group input-group-sm" style="width: 250px;">
                        <input type="text" class="form-control" placeholder="Filter by genre, mode..." id="historyFilter">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="historyTable">
                        <thead>
                            <tr>
                                <th>Project</th>
                                <th>Genre</th>
                                <th>Mode</th>
                                <th>Tracks</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in analytics.generation_history[:20] %}
                            <tr>
                                <td>
                                    <div class="fw-bold">{{ item.title }}</div>
                                    <small class="text-muted">{{ item.project }}</small>
                                </td>
                                <td>
                                    {% if item.genre %}
                                        <span class="badge bg-primary">{{ item.genre }}</span>
                                    {% else %}
                                        <span class="text-muted">Unknown</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'success' if item.mode == 'real' else 'warning' if item.mode == 'hybrid' else 'info' }}">
                                        {{ item.mode.title() }}
                                    </span>
                                </td>
                                <td>{{ item.tracks_created or 0 }}</td>
                                <td>
                                    {% if item.success %}
                                        <i class="fas fa-check-circle text-success me-1"></i>Success
                                    {% else %}
                                        <i class="fas fa-times-circle text-danger me-1"></i>Failed
                                    {% endif %}
                                </td>
                                <td>
                                    <small>{{ item.created_at[:19]|replace('T', ' ') if item.created_at else 'Unknown' }}</small>
                                </td>
                                <td>
                                    <button class="btn btn-outline-primary btn-sm" onclick="viewGenerationDetails('{{ item.project }}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                            
                            {% if not analytics.generation_history %}
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-2 opacity-25"></i>
                                    <br>No generation history available
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- API Usage Statistics -->
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-plug me-2"></i>
                API Usage Today
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Suno API</span>
                        <span class="fw-bold">12 calls</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-primary" style="width: 60%"></div>
                    </div>
                    <small class="text-muted">60% of daily limit</small>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Gemini AI</span>
                        <span class="fw-bold">28 calls</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-info" style="width: 35%"></div>
                    </div>
                    <small class="text-muted">35% of daily limit</small>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Nano-Banana (Gemini Image)</span>
                        <span class="fw-bold">5 calls</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-warning" style="width: 25%"></div>
                    </div>
                    <small class="text-muted">25% of daily limit</small>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-dollar-sign me-2"></i>
                Cost Analysis
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <div class="h3 text-success">$23.45</div>
                    <small class="text-muted">Total spent this month</small>
                </div>
                
                <div class="mb-2">
                    <div class="d-flex justify-content-between">
                        <span>Suno API</span>
                        <span>$18.20</span>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="d-flex justify-content-between">
                        <span>Gemini AI</span>
                        <span>$2.15</span>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="d-flex justify-content-between">
                        <span>Nano-Banana (Gemini Image)</span>
                        <span>$3.10</span>
                    </div>
                </div>
                
                <hr>
                <div class="small text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Estimates based on usage patterns
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-server me-2"></i>
                System Health
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>CPU Usage</span>
                        <span class="fw-bold">45%</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-success" style="width: 45%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Memory Usage</span>
                        <span class="fw-bold">62%</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-warning" style="width: 62%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Disk Usage</span>
                        <span class="fw-bold">38%</span>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-info" style="width: 38%"></div>
                    </div>
                </div>
                
                <div class="text-center">
                    <span class="badge bg-success">System Healthy</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Analytics Dashboard JavaScript
    
    // Initialize charts
    let generationTrendsChart, genreDistributionChart, performanceChart;
    
    window.addEventListener('load', function() {
        initializeCharts();
        setupRealTimeUpdates();
    });
    
    function initializeCharts() {
        // Generation Trends Chart
        const trendsCtx = document.getElementById('generationTrendsChart').getContext('2d');
        generationTrendsChart = new Chart(trendsCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Total Requests',
                    data: [3, 7, 2, 5, 8, 4, 6],
                    borderColor: '#2c3e50',
                    backgroundColor: 'rgba(44, 62, 80, 0.05)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }, {
                    label: 'Successful',
                    data: [3, 6, 2, 4, 7, 4, 5],
                    borderColor: '#27ae60',
                    backgroundColor: 'rgba(39, 174, 96, 0.05)',
                    tension: 0.4,
                    fill: false,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Genre Distribution Chart
        const genreCtx = document.getElementById('genreDistributionChart').getContext('2d');
        const genreData = {
            {% set genres = {} %}
            {% for item in analytics.generation_history %}
                {% if item.genre %}
                    {% set _ = genres.update({item.genre: genres.get(item.genre, 0) + 1}) %}
                {% endif %}
            {% endfor %}
            labels: [{% for genre in genres.keys() %}'{{ genre }}'{% if not loop.last %},{% endif %}{% endfor %}],
            data: [{% for count in genres.values() %}{{ count }}{% if not loop.last %},{% endif %}{% endfor %}]
        };
        
        genreDistributionChart = new Chart(genreCtx, {
            type: 'doughnut',
            data: {
                labels: genreData.labels,
                datasets: [{
                    data: genreData.data,
                    backgroundColor: [
                        '#2c3e50', '#34495e', '#7f8c8d', '#95a5a6', 
                        '#bdc3c7', '#ecf0f1', '#3498db', '#27ae60'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        display: false
                    }
                }
            }
        });
        
        // Performance Chart
        const perfCtx = document.getElementById('performanceChart').getContext('2d');
        performanceChart = new Chart(perfCtx, {
            type: 'bar',
            data: {
                labels: ['API Response', 'Generation Time', 'File Processing', 'Total Time'],
                datasets: [{
                    label: 'Average (seconds)',
                    data: [2.3, 145.7, 8.2, 156.2],
                    backgroundColor: ['#2c3e50', '#34495e', '#7f8c8d', '#95a5a6'],
                    borderColor: ['#2c3e50', '#34495e', '#7f8c8d', '#95a5a6'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    
    function setupRealTimeUpdates() {
        // Update charts every 30 seconds
        setInterval(updateCharts, 30000);
    }
    
    function updateCharts() {
        // Simulate real-time data updates
        if (generationTrendsChart) {
            const newData = Math.floor(Math.random() * 10);
            generationTrendsChart.data.datasets[0].data.shift();
            generationTrendsChart.data.datasets[0].data.push(newData);
            generationTrendsChart.update();
        }
    }
    
    function refreshAnalytics() {
        const button = event.target;
        const originalText = button.innerHTML;
        
        showLoading(button);
        
        setTimeout(() => {
            hideLoading(button, originalText);
            showToast('Analytics data refreshed!', 'success');
            updateCharts();
        }, 2000);
    }
    
    function exportAnalytics() {
        Swal.fire({
            title: 'Export Analytics',
            html: `
                <div class="mb-3">
                    <label class="form-label">Export Format:</label>
                    <select class="form-select" id="exportFormat">
                        <option value="csv">CSV File</option>
                        <option value="pdf">PDF Report</option>
                        <option value="json">JSON Data</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Time Period:</label>
                    <select class="form-select" id="exportPeriod">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="all">All time</option>
                    </select>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Export',
            preConfirm: () => {
                const format = document.getElementById('exportFormat').value;
                const period = document.getElementById('exportPeriod').value;
                return { format, period };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const { format, period } = result.value;
                showToast(`Exporting analytics as ${format.toUpperCase()}...`, 'info');
                
                // Simulate export
                setTimeout(() => {
                    showToast(`Analytics exported successfully!`, 'success');
                }, 2000);
            }
        });
    }
    
    function viewGenerationDetails(projectName) {
        Swal.fire({
            title: 'Generation Details',
            html: `
                <div class="text-start">
                    <h6>Project: ${projectName}</h6>
                    <ul class="list-unstyled">
                        <li><strong>Status:</strong> Completed Successfully</li>
                        <li><strong>Duration:</strong> 4 minutes 32 seconds</li>
                        <li><strong>API Calls:</strong> 3 (Suno), 1 (Gemini)</li>
                        <li><strong>Files Generated:</strong> 2 audio, 1 metadata</li>
                        <li><strong>Total Size:</strong> 15.2 MB</li>
                    </ul>
                    
                    <h6 class="mt-3">Performance Metrics:</h6>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-success" style="width: 85%">Quality: 85%</div>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-info" style="width: 92%">Speed: 92%</div>
                    </div>
                    <div class="progress mb-2">
                        <div class="progress-bar bg-warning" style="width: 78%">Cost Efficiency: 78%</div>
                    </div>
                </div>
            `,
            width: 500,
            confirmButtonText: 'Close'
        });
    }
    
    function showErrorDetails() {
        Swal.fire({
            title: 'Error Analysis',
            html: `
                <div class="text-start">
                    <h6>Recent Errors:</h6>
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">API Timeout</h6>
                                <small>2 hours ago</small>
                            </div>
                            <p class="mb-1">Suno API request timed out after 60 seconds</p>
                            <small class="text-muted">Project: Lo-Fi Collection #3</small>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">Rate Limited</h6>
                                <small>4 hours ago</small>
                            </div>
                            <p class="mb-1">Exceeded rate limit for Gemini API</p>
                            <small class="text-muted">Retried successfully after 30s</small>
                        </div>
                    </div>
                </div>
            `,
            width: 600,
            confirmButtonText: 'Close'
        });
    }
    
    // History table filtering
    document.getElementById('historyFilter').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('#historyTable tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
    
    // Period selector for charts
    document.querySelectorAll('input[name="chartPeriod"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const period = this.id.replace('period', '');
            updateChartsPeriod(period);
        });
    });
    
    function updateChartsPeriod(days) {
        // Update chart data based on selected period
        showToast(`Updated charts for last ${days} days`, 'info');
    }
</script>
{% endblock %}
{% extends "base.html" %}

{% block title %}Rezultatai - Autonominis Muzikantas{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“‚ Sugeneruoti Rezultatai</h2>
    
    {% if outputs %}
        <p>Rasta {{ outputs|length }} rezultatÅ³ aplankÅ³:</p>
        
        {% for output in outputs %}
        <div class="card" style="border-left: 4px solid #4CAF50;">
            <div class="grid" style="grid-template-columns: 2fr 1fr; align-items: start;">
                <div>
                    <h3>ğŸµ {{ output.metadata.title or output.name }}</h3>
                    
                    <div style="margin: 1rem 0;">
                        {% if output.metadata.created_at %}
                        <p><strong>ğŸ“… Sukurta:</strong> {{ output.metadata.created_at[:19] | replace('T', ' ') }}</p>
                        {% endif %}
                        
                        {% if output.metadata.genre %}
                        <p><strong>ğŸ¼ Å½anras:</strong> {{ output.metadata.genre }}</p>
                        {% endif %}
                        
                        {% if output.metadata.theme %}
                        <p><strong>ğŸ’­ Tema:</strong> {{ output.metadata.theme }}</p>
                        {% endif %}
                        
                        {% if output.metadata.mode %}
                        <p><strong>âš™ï¸ ReÅ¾imas:</strong> 
                           {% if output.metadata.mode == 'mock' %}ğŸ§ª Testavimo{% else %}ğŸ”‘ Realus{% endif %}
                        </p>
                        {% endif %}
                        
                        {% if output.metadata.tracks_created %}
                        <p><strong>ğŸµ Takeliai:</strong> {{ output.metadata.tracks_created }}</p>
                        {% endif %}
                        
                        {% if output.metadata.cover_created is defined %}
                        <p><strong>ğŸ–¼ï¸ VirÅ¡elis:</strong> {% if output.metadata.cover_created %}âœ… Sukurtas{% else %}âŒ Nesukurtas{% endif %}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <strong>ğŸ“ Failai aplankĞµ:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            {% for file in output.files %}
                            <li>
                                {{ file }}
                                {% if file.endswith('.mp3') %}ğŸµ
                                {% elif file.endswith('.jpg') or file.endswith('.png') %}ğŸ–¼ï¸
                                {% elif file.endswith('.mp4') %}ğŸ¬
                                {% elif file.endswith('.json') %}ğŸ“„
                                {% elif file.endswith('.txt') %}ğŸ“
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <div style="margin-bottom: 1rem;">
                        <strong>{{ output.files|length }}</strong><br>
                        <small>failÅ³</small>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <!-- Download individual files -->
                        {% for file in output.files %}
                            {% if file.endswith('.mp3') or file.endswith('.jpg') or file.endswith('.png') or file.endswith('.mp4') %}
                            <a href="/download/{{ output.name }}/{{ file }}" 
                               class="btn btn-secondary" 
                               style="font-size: 12px; padding: 5px 10px;"
                               download>
                                ğŸ“¥ {{ file }}
                            </a>
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Folder path for manual access -->
                        <small style="word-break: break-all; color: #ccc;">
                            {{ output.path }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        
    {% else %}
        <div class="alert alert-warning">
            <strong>ğŸ“­ RezultatÅ³ nÄ—ra</strong><br>
            Dar nesugenerjavote jokiÅ³ muzikos failÅ³. 
            <a href="/">PradÄ—kite generavimÄ…</a> pirmame puslapyje.
        </div>
    {% endif %}
</div>

<!-- Summary Statistics -->
{% if outputs %}
<div class="card">
    <h2>ğŸ“Š Statistika</h2>
    <div class="grid">
        <div class="card">
            <h3 style="text-align: center; color: #4CAF50;">{{ outputs|length }}</h3>
            <p style="text-align: center; margin: 0;">SugeneruotÅ³ projektÅ³</p>
        </div>
        
        <div class="card">
            <h3 style="text-align: center; color: #2196F3;">
                {{ outputs|selectattr('metadata.tracks_created')|map(attribute='metadata.tracks_created')|sum }}
            </h3>
            <p style="text-align: center; margin: 0;">SukurtÅ³ takeliÅ³</p>
        </div>
        
        <div class="card">
            <h3 style="text-align: center; color: #ff9800;">
                {{ outputs|selectattr('metadata.mode', 'equalto', 'real')|list|length }}
            </h3>
            <p style="text-align: center; margin: 0;">RealiÅ³ generavimÅ³</p>
        </div>
        
        <div class="card">
            <h3 style="text-align: center; color: #9C27B0;">
                {{ outputs|selectattr('metadata.cover_created', 'equalto', true)|list|length }}
            </h3>
            <p style="text-align: center; margin: 0;">Su virÅ¡eliais</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Actions -->
<div class="card">
    <h2>âš¡ Veiksmai</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="/" class="btn">ğŸš€ Sukurti NaujÄ…</a>
        <a href="/status" class="btn btn-secondary">ğŸ“Š PerÅ¾iÅ«rÄ—ti BÅ«senÄ…</a>
        <button onclick="window.location.reload()" class="btn btn-warning">ğŸ”„ Atnaujinti SÄ…raÅ¡Ä…</button>
    </div>
</div>

<!-- Instructions -->
<div class="card">
    <h2>ğŸ’¡ Patarimai</h2>
    <ul style="line-height: 1.6;">
        <li><strong>ğŸ“¥ Atsisiuntimas:</strong> Spauskite ant failÅ³ pavadinimÅ³, kad atsisiÅ³stumÄ—te juos</li>
        <li><strong>ğŸ“ AplankÅ³ vietos:</strong> Visi failai saugomi <code>output/</code> kataloge</li>
        <li><strong>ğŸµ Audio failai:</strong> MP3 formatu, tinka daugumai audio grotuvÅ³</li>
        <li><strong>ğŸ–¼ï¸ VirÅ¡eliai:</strong> JPG/PNG formatu, jei buvo sugeneruoti</li>
        <li><strong>ğŸ“„ Metadata:</strong> JSON failuose saugoma informacija apie projektÄ…</li>
    </ul>
</div>
{% endblock %}
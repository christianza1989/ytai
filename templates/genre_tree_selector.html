<!-- 🎵 INTERACTIVE GENRE TREE SELECTOR COMPONENT -->
<div class="genre-tree-selector">
    <div class="row">
        <!-- Genre Tree Navigation -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-sitemap me-2"></i>Genre Tree Selection</h5>
                    <div class="genre-stats-legend">
                        <span class="legend-item">
                            <span class="color-box" style="background: #27ae60;"></span>
                            High Profit
                        </span>
                        <span class="legend-item">
                            <span class="color-box" style="background: #f39c12;"></span>
                            Medium Profit
                        </span>
                        <span class="legend-item">
                            <span class="color-box" style="background: #e74c3c;"></span>
                            Low Profit
                        </span>
                        <span class="legend-item">
                            <i class="fas fa-fire text-danger"></i> Trending
                        </span>
                        <span class="legend-item">
                            <i class="fas fa-seedling text-success"></i> Easy Start
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Quick Recommendations -->
                    <div class="recommendations-bar mb-4">
                        <button class="btn btn-success btn-sm me-2" onclick="showRecommendedGenres('profitable')">
                            <i class="fas fa-dollar-sign"></i> Most Profitable
                        </button>
                        <button class="btn btn-warning btn-sm me-2" onclick="showRecommendedGenres('trending')">
                            <i class="fas fa-fire"></i> Trending Now
                        </button>
                        <button class="btn btn-info btn-sm me-2" onclick="showRecommendedGenres('easy')">
                            <i class="fas fa-seedling"></i> Easy to Start
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showAllGenres()">
                            <i class="fas fa-list"></i> Show All
                        </button>
                    </div>

                    <!-- Genre Tree -->
                    <div id="genreTreeContainer" class="genre-tree">
                        <!-- Dinamiškai generuojama JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Selected Genre Details -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6><i class="fas fa-info-circle me-2"></i>Genre Analytics</h6>
                </div>
                <div class="card-body">
                    <div id="genreDetails">
                        <div class="text-center text-muted">
                            <i class="fas fa-mouse-pointer fa-2x mb-3"></i>
                            <p>Select a genre to see detailed statistics and recommendations</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vocal Configuration Preview -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6><i class="fas fa-microphone me-2"></i>Vocal Strategy</h6>
                </div>
                <div class="card-body">
                    <div id="vocalPreview">
                        <div class="text-center text-muted">
                            <i class="fas fa-music fa-2x mb-3"></i>
                            <p>Vocal configuration will be shown here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden input for selected genre -->
    <input type="hidden" id="selectedGenre" name="selected_genre">
    <input type="hidden" id="selectedSubgenre" name="selected_subgenre">
    <input type="hidden" id="selectedSubstyle" name="selected_substyle">
</div>

<style>
.genre-tree-selector {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.genre-stats-legend {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    font-size: 0.8rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

.color-box {
    width: 12px;
    height: 12px;
    border-radius: 2px;
}

.genre-tree {
    max-height: 600px;
    overflow-y: auto;
}

.genre-category {
    margin-bottom: 20px;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    overflow: hidden;
}

.category-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category-header:hover {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
}

.category-header.active {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
}

.category-title {
    font-weight: 600;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.category-stats {
    font-size: 0.85rem;
    opacity: 0.9;
}

.subgenres-container {
    padding: 0;
    display: none;
    background: #f8f9fa;
}

.subgenres-container.show {
    display: block;
}

.subgenre-item {
    padding: 12px 20px;
    border-bottom: 1px solid #e9ecef;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: between;
    align-items: center;
}

.subgenre-item:hover {
    background: #e3f2fd;
    transform: translateX(5px);
}

.subgenre-item.selected {
    background: #e8f5e8;
    border-left: 4px solid #28a745;
}

.subgenre-info {
    flex: 1;
}

.subgenre-name {
    font-weight: 500;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 8px;
}

.subgenre-description {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 2px;
}

.subgenre-stats {
    text-align: right;
    font-size: 0.8rem;
}

.profit-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 5px;
}

.profit-high { background: #27ae60; }
.profit-medium { background: #f39c12; }
.profit-low { background: #e74c3c; }

.trending-badge {
    background: linear-gradient(45deg, #ff6b6b, #ffa500);
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 5px;
}

.easy-badge {
    background: linear-gradient(45deg, #51cf66, #40c057);
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 5px;
}

.substyles-container {
    background: #ffffff;
    padding: 10px 20px;
    margin-left: 20px;
    border-left: 2px solid #dee2e6;
}

.substyle-item {
    padding: 8px 15px;
    margin: 5px 0;
    background: #f1f3f4;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.substyle-item:hover {
    background: #e8eaed;
    transform: scale(1.02);
}

.substyle-item.selected {
    background: #d4edda;
    border: 1px solid #c3e6cb;
}

.vocal-probability {
    font-size: 0.75rem;
    color: #495057;
}

.recommendations-bar {
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

/* Genre Details Styling */
.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.stat-label {
    font-weight: 500;
    color: #495057;
}

.stat-value {
    font-weight: 600;
}

.profit-value { color: #28a745; }
.popularity-value { color: #007bff; }
.competition-value { color: #dc3545; }
.trend-value { color: #ffc107; }

.progress-bar-container {
    background: #e9ecef;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 4px;
}

.progress-bar {
    height: 100%;
    transition: width 0.3s ease;
}

.vocal-config-item {
    padding: 10px;
    margin: 5px 0;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 3px solid #007bff;
}

.vocal-type {
    font-weight: 600;
    color: #495057;
}

.vocal-details {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 5px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .genre-stats-legend {
        font-size: 0.7rem;
        gap: 10px;
    }
    
    .category-header {
        padding: 12px 15px;
    }
    
    .category-title {
        font-size: 1rem;
    }
    
    .subgenre-item {
        padding: 10px 15px;
    }
    
    .recommendations-bar {
        text-align: center;
    }
    
    .recommendations-bar .btn {
        margin-bottom: 5px;
    }
}

/* Animation for smooth transitions */
.genre-category {
    animation: slideInUp 0.3s ease;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.subgenres-container {
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        max-height: 0;
        opacity: 0;
    }
    to {
        max-height: 1000px;
        opacity: 1;
    }
}

/* Loading state */
.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// Genre Tree Data - will be populated by Python backend
let genreTreeData = {};
let selectedPath = {
    category: null,
    subgenre: null,
    substyle: null
};

// Initialize genre tree selector
function initGenreTreeSelector() {
    loadGenreTreeData();
    renderGenreTree();
}

// Load genre tree data from backend
async function loadGenreTreeData() {
    try {
        const response = await fetch('/api/genres/tree');
        genreTreeData = await response.json();
        renderGenreTree();
    } catch (error) {
        console.error('Failed to load genre tree:', error);
        // Fallback to static data for demo
        loadMockGenreData();
    }
}

// Render complete genre tree
function renderGenreTree() {
    const container = document.getElementById('genreTreeContainer');
    container.innerHTML = '';

    Object.entries(genreTreeData).forEach(([categoryName, categoryData]) => {
        const categoryElement = createCategoryElement(categoryName, categoryData);
        container.appendChild(categoryElement);
    });
}

// Create category element
function createCategoryElement(categoryName, categoryData) {
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'genre-category';
    categoryDiv.setAttribute('data-category', categoryName);

    const headerDiv = document.createElement('div');
    headerDiv.className = 'category-header';
    headerDiv.onclick = () => toggleCategory(categoryName);

    const titleDiv = document.createElement('div');
    titleDiv.className = 'category-title';
    titleDiv.innerHTML = `
        <span style="font-size: 1.2em;">${categoryData.icon || '🎵'}</span>
        <span>${categoryData.description || categoryName}</span>
        ${categoryData.statistics ? getCategoryBadges(categoryData.statistics) : ''}
    `;

    const statsDiv = document.createElement('div');
    statsDiv.className = 'category-stats';
    if (categoryData.statistics) {
        statsDiv.innerHTML = `
            $${categoryData.statistics.monthly_revenue}/mo | 
            ${categoryData.statistics.popularity_score}% pop | 
            ${categoryData.statistics.growth_trend > 0 ? '+' : ''}${categoryData.statistics.growth_trend}% trend
        `;
    }

    headerDiv.appendChild(titleDiv);
    headerDiv.appendChild(statsDiv);

    const subgenresDiv = document.createElement('div');
    subgenresDiv.className = 'subgenres-container';
    subgenresDiv.id = `subgenres-${categoryName}`;

    if (categoryData.subgenres) {
        Object.entries(categoryData.subgenres).forEach(([subgenreName, subgenreData]) => {
            const subgenreElement = createSubgenreElement(categoryName, subgenreName, subgenreData);
            subgenresDiv.appendChild(subgenreElement);
        });
    }

    categoryDiv.appendChild(headerDiv);
    categoryDiv.appendChild(subgenresDiv);

    return categoryDiv;
}

// Create subgenre element
function createSubgenreElement(categoryName, subgenreName, subgenreData) {
    const subgenreDiv = document.createElement('div');
    subgenreDiv.className = 'subgenre-item';
    subgenreDiv.setAttribute('data-subgenre', subgenreName);
    subgenreDiv.onclick = () => selectSubgenre(categoryName, subgenreName, subgenreData);

    const infoDiv = document.createElement('div');
    infoDiv.className = 'subgenre-info';

    const nameDiv = document.createElement('div');
    nameDiv.className = 'subgenre-name';
    nameDiv.innerHTML = `
        <span>${subgenreData.icon || '🎶'}</span>
        <span>${subgenreData.description || subgenreName}</span>
        ${getSubgenreBadges(subgenreData)}
    `;

    const descriptionDiv = document.createElement('div');
    descriptionDiv.className = 'subgenre-description';
    descriptionDiv.textContent = `Vocal probability: ${Math.round((subgenreData.statistics?.vocal_preference || 0.5) * 100)}%`;

    infoDiv.appendChild(nameDiv);
    infoDiv.appendChild(descriptionDiv);

    const statsDiv = document.createElement('div');
    statsDiv.className = 'subgenre-stats';
    if (subgenreData.statistics) {
        const profit = subgenreData.statistics.monthly_revenue;
        const profitClass = profit > 3000 ? 'profit-high' : profit > 2000 ? 'profit-medium' : 'profit-low';
        
        statsDiv.innerHTML = `
            <div><span class="profit-indicator ${profitClass}"></span>$${profit}/mo</div>
            <div>${subgenreData.statistics.popularity_score}% popularity</div>
            <div>${100 - subgenreData.statistics.competition_level}% opportunity</div>
        `;
    }

    subgenreDiv.appendChild(infoDiv);
    subgenreDiv.appendChild(statsDiv);

    // Add substyles if they exist
    if (subgenreData.substyles) {
        const substylesContainer = document.createElement('div');
        substylesContainer.className = 'substyles-container';
        substylesContainer.style.display = 'none';

        Object.entries(subgenreData.substyles).forEach(([substyleName, substyleData]) => {
            const substyleElement = createSubstyleElement(categoryName, subgenreName, substyleName, substyleData);
            substylesContainer.appendChild(substyleElement);
        });

        subgenreDiv.appendChild(substylesContainer);
    }

    return subgenreDiv;
}

// Create substyle element
function createSubstyleElement(categoryName, subgenreName, substyleName, substyleData) {
    const substyleDiv = document.createElement('div');
    substyleDiv.className = 'substyle-item';
    substyleDiv.onclick = (e) => {
        e.stopPropagation();
        selectSubstyle(categoryName, subgenreName, substyleName, substyleData);
    };

    const nameDiv = document.createElement('div');
    nameDiv.innerHTML = `
        <strong>${substyleName.replace(/_/g, ' ')}</strong>
        <br><small>${substyleData.trending_keywords?.join(', ') || ''}</small>
    `;

    const vocalDiv = document.createElement('div');
    vocalDiv.className = 'vocal-probability';
    vocalDiv.textContent = `${Math.round(substyleData.vocal_probability * 100)}% vocal`;

    substyleDiv.appendChild(nameDiv);
    substyleDiv.appendChild(vocalDiv);

    return substyleDiv;
}

// Get category badges
function getCategoryBadges(statistics) {
    let badges = '';
    
    if (statistics.growth_trend > 30) {
        badges += '<span class="trending-badge"><i class="fas fa-fire"></i> HOT</span>';
    }
    
    if (statistics.difficulty_level < 40) {
        badges += '<span class="easy-badge"><i class="fas fa-seedling"></i> EASY</span>';
    }
    
    return badges;
}

// Get subgenre badges
function getSubgenreBadges(subgenreData) {
    let badges = '';
    
    if (subgenreData.statistics?.growth_trend > 25) {
        badges += '<span class="trending-badge">🔥</span>';
    }
    
    if (subgenreData.statistics?.difficulty_level < 35) {
        badges += '<span class="easy-badge">🌱</span>';
    }
    
    return badges;
}

// Toggle category visibility
function toggleCategory(categoryName) {
    const subgenresContainer = document.getElementById(`subgenres-${categoryName}`);
    const header = document.querySelector(`[data-category="${categoryName}"] .category-header`);
    
    // Close other categories
    document.querySelectorAll('.subgenres-container').forEach(container => {
        if (container.id !== `subgenres-${categoryName}`) {
            container.classList.remove('show');
        }
    });
    
    document.querySelectorAll('.category-header').forEach(h => {
        if (h !== header) {
            h.classList.remove('active');
        }
    });
    
    // Toggle current category
    subgenresContainer.classList.toggle('show');
    header.classList.toggle('active');
}

// Select subgenre
function selectSubgenre(categoryName, subgenreName, subgenreData) {
    // Update selection
    selectedPath = {
        category: categoryName,
        subgenre: subgenreName,
        substyle: null
    };
    
    // Update UI
    document.querySelectorAll('.subgenre-item').forEach(item => item.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    
    // Update hidden inputs
    document.getElementById('selectedGenre').value = categoryName;
    document.getElementById('selectedSubgenre').value = subgenreName;
    document.getElementById('selectedSubstyle').value = '';
    
    // Show substyles if available
    const substylesContainer = event.currentTarget.querySelector('.substyles-container');
    if (substylesContainer) {
        substylesContainer.style.display = substylesContainer.style.display === 'block' ? 'none' : 'block';
    }
    
    // Update details panel
    updateGenreDetails(categoryName, subgenreName, subgenreData);
    
    // Update vocal preview
    updateVocalPreview(subgenreData);
}

// Select substyle
function selectSubstyle(categoryName, subgenreName, substyleName, substyleData) {
    selectedPath.substyle = substyleName;
    
    // Update UI
    document.querySelectorAll('.substyle-item').forEach(item => item.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    
    // Update hidden input
    document.getElementById('selectedSubstyle').value = substyleName;
    
    // Update vocal preview with substyle data
    updateVocalPreviewWithSubstyle(substyleData);
}

// Update genre details panel
function updateGenreDetails(categoryName, subgenreName, subgenreData) {
    const detailsContainer = document.getElementById('genreDetails');
    
    if (!subgenreData.statistics) {
        detailsContainer.innerHTML = '<p>No statistics available for this genre.</p>';
        return;
    }
    
    const stats = subgenreData.statistics;
    
    detailsContainer.innerHTML = `
        <h6>${subgenreData.icon || '🎶'} ${subgenreName.replace(/_/g, ' ')}</h6>
        <p class="text-muted small mb-3">${subgenreData.description || ''}</p>
        
        <div class="stat-item">
            <span class="stat-label">Monthly Revenue:</span>
            <span class="stat-value profit-value">$${stats.monthly_revenue.toFixed(0)}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Popularity:</span>
            <span class="stat-value popularity-value">${stats.popularity_score}%</span>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar" style="width: ${stats.popularity_score}%; background: #007bff;"></div>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Competition:</span>
            <span class="stat-value competition-value">${stats.competition_level}%</span>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar" style="width: ${stats.competition_level}%; background: #dc3545;"></div>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Growth Trend:</span>
            <span class="stat-value trend-value">${stats.growth_trend > 0 ? '+' : ''}${stats.growth_trend}%</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Difficulty:</span>
            <span class="stat-value">${stats.difficulty_level}/100</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Monetization Rate:</span>
            <span class="stat-value profit-value">${stats.monetization_rate}%</span>
        </div>
        
        <div class="stat-item">
            <span class="stat-label">Audience Retention:</span>
            <span class="stat-value">${stats.audience_retention}%</span>
        </div>
    `;
}

// Update vocal preview
function updateVocalPreview(subgenreData) {
    const previewContainer = document.getElementById('vocalPreview');
    
    const vocalPref = subgenreData.statistics?.vocal_preference || 0.5;
    const vocalPercentage = Math.round(vocalPref * 100);
    
    let vocalType = '';
    let description = '';
    
    if (vocalPref < 0.2) {
        vocalType = 'Mostly Instrumental';
        description = 'This genre typically works best without vocals or with minimal atmospheric sounds.';
    } else if (vocalPref < 0.4) {
        vocalType = 'Light Vocals';
        description = 'Occasional atmospheric vocals (ahhs, ohhs) or short vocal hooks work well.';
    } else if (vocalPref < 0.7) {
        vocalType = 'Mixed Vocals';
        description = 'Both vocal and instrumental tracks perform well. AI will decide based on context.';
    } else {
        vocalType = 'Vocal Focused';
        description = 'This genre strongly benefits from vocals - lyrics, rap, or melodic singing.';
    }
    
    previewContainer.innerHTML = `
        <div class="vocal-config-item">
            <div class="vocal-type">${vocalType} (${vocalPercentage}%)</div>
            <div class="vocal-details">${description}</div>
        </div>
        
        <div class="mt-3">
            <small class="text-muted">
                <strong>AI Decision Engine:</strong> Gemini AI will automatically choose the best vocal approach based on:
                <ul class="mt-2 small">
                    <li>Time of day (study hours = less vocals)</li>
                    <li>Target audience context</li>
                    <li>Current trending patterns</li>
                    <li>Genre-specific best practices</li>
                </ul>
            </small>
        </div>
    `;
}

// Update vocal preview with substyle
function updateVocalPreviewWithSubstyle(substyleData) {
    const previewContainer = document.getElementById('vocalPreview');
    const vocalProb = substyleData.vocal_probability;
    const preferredVocals = substyleData.preferred_vocals || [];
    const keywords = substyleData.trending_keywords || [];
    
    previewContainer.innerHTML = `
        <div class="vocal-config-item">
            <div class="vocal-type">Vocal Probability: ${Math.round(vocalProb * 100)}%</div>
            <div class="vocal-details">
                <strong>Preferred Styles:</strong> ${preferredVocals.join(', ')}<br>
                <strong>Trending Keywords:</strong> ${keywords.join(', ')}
            </div>
        </div>
    `;
}

// Show recommended genres
async function showRecommendedGenres(type) {
    const container = document.getElementById('genreTreeContainer');
    
    // Show loading
    container.innerHTML = '<div class="loading-overlay"><div class="loading-spinner"></div></div>';
    
    try {
        const response = await fetch(`/api/genres/recommendations/${type}`);
        const recommendations = await response.json();
        
        renderRecommendations(recommendations, type);
    } catch (error) {
        console.error('Failed to load recommendations:', error);
        renderGenreTree(); // Fallback to full tree
    }
}

// Render recommendations
function renderRecommendations(recommendations, type) {
    const container = document.getElementById('genreTreeContainer');
    
    let title = '';
    switch (type) {
        case 'profitable':
            title = '💰 Most Profitable Genres';
            break;
        case 'trending':
            title = '🔥 Trending Genres';
            break;
        case 'easy':
            title = '🌱 Easiest to Start';
            break;
    }
    
    let html = `<div class="recommendations-header mb-3">
        <h5>${title}</h5>
        <p class="text-muted">Based on real market data and performance metrics</p>
    </div>`;
    
    recommendations.forEach((rec, index) => {
        const [genrePath, data] = rec;
        const [category, subgenre] = genrePath.split('.');
        
        html += `
            <div class="recommendation-item" onclick="selectRecommendedGenre('${category}', '${subgenre}')">
                <div class="rec-rank">#${index + 1}</div>
                <div class="rec-info">
                    <div class="rec-name">${data.data.icon || '🎶'} ${subgenre.replace(/_/g, ' ')}</div>
                    <div class="rec-category">${category}</div>
                </div>
                <div class="rec-stats">
                    <div class="rec-score">${data[type + '_score']?.toFixed(1) || data.profit_score?.toFixed(1) || 'N/A'}</div>
                    <div class="rec-revenue">$${data.data.statistics.monthly_revenue}/mo</div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Select recommended genre
function selectRecommendedGenre(category, subgenre) {
    // Load full tree and select the genre
    loadGenreTreeData().then(() => {
        renderGenreTree();
        
        // Auto-expand and select
        setTimeout(() => {
            toggleCategory(category);
            // Find and click the subgenre
            const subgenreElement = document.querySelector(`[data-subgenre="${subgenre}"]`);
            if (subgenreElement) {
                subgenreElement.click();
            }
        }, 300);
    });
}

// Show all genres
function showAllGenres() {
    renderGenreTree();
}

// Load mock data for demonstration
function loadMockGenreData() {
    genreTreeData = {
        "ELECTRONIC": {
            "description": "Electronic Dance Music",
            "icon": "🎧",
            "statistics": {
                "monthly_revenue": 2850,
                "popularity_score": 85,
                "growth_trend": 25,
                "competition_level": 75,
                "difficulty_level": 60,
                "vocal_preference": 0.35
            },
            "subgenres": {
                "HOUSE": {
                    "description": "Classic House Music",
                    "icon": "🏠",
                    "statistics": {
                        "monthly_revenue": 3200,
                        "popularity_score": 88,
                        "growth_trend": 30,
                        "competition_level": 80,
                        "difficulty_level": 45,
                        "vocal_preference": 0.45,
                        "monetization_rate": 85,
                        "audience_retention": 82
                    },
                    "substyles": {
                        "DEEP_HOUSE": {
                            "vocal_probability": 0.6,
                            "preferred_vocals": ["atmospheric_vocals", "minimal_vocals"],
                            "trending_keywords": ["deep", "soulful", "underground"]
                        },
                        "TECH_HOUSE": {
                            "vocal_probability": 0.3,
                            "preferred_vocals": ["minimal_vocals", "vocal_chops"],
                            "trending_keywords": ["tech", "driving", "hypnotic"]
                        }
                    }
                }
            }
        },
        "CHILLOUT": {
            "description": "Relaxing Music",
            "icon": "🌙",
            "statistics": {
                "monthly_revenue": 3800,
                "popularity_score": 92,
                "growth_trend": 45,
                "competition_level": 60,
                "difficulty_level": 35,
                "vocal_preference": 0.25
            },
            "subgenres": {
                "LO_FI_HIP_HOP": {
                    "description": "Study & Relaxation Beats",
                    "icon": "📚",
                    "statistics": {
                        "monthly_revenue": 4200,
                        "popularity_score": 95,
                        "growth_trend": 55,
                        "competition_level": 55,
                        "difficulty_level": 25,
                        "vocal_preference": 0.15,
                        "monetization_rate": 95,
                        "audience_retention": 92
                    }
                }
            }
        }
    };
    
    renderGenreTree();
}

// Initialize when document loads
document.addEventListener('DOMContentLoaded', function() {
    initGenreTreeSelector();
});
</script>

<style>
.recommendation-item {
    display: flex;
    align-items: center;
    padding: 15px;
    margin: 10px 0;
    background: #f8f9fa;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 4px solid transparent;
}

.recommendation-item:hover {
    background: #e3f2fd;
    border-left-color: #2196F3;
    transform: translateX(5px);
}

.rec-rank {
    font-size: 1.5rem;
    font-weight: bold;
    color: #007bff;
    margin-right: 15px;
    min-width: 40px;
}

.rec-info {
    flex: 1;
}

.rec-name {
    font-weight: 600;
    color: #2c3e50;
}

.rec-category {
    font-size: 0.85rem;
    color: #6c757d;
}

.rec-stats {
    text-align: right;
}

.rec-score {
    font-size: 1.2rem;
    font-weight: bold;
    color: #28a745;
}

.rec-revenue {
    font-size: 0.85rem;
    color: #6c757d;
}

.recommendations-header {
    text-align: center;
    padding: 20px;
    border-bottom: 2px solid #dee2e6;
}
</style>
{% extends "base.html" %}

{% block title %}Generavimo BÅ«sena - Autonominis Muzikantas{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“Š Generavimo BÅ«sena</h2>
    
    {% if status.running %}
        <div class="alert alert-success">
            <strong>ğŸ”„ Generavimas vyksta...</strong>
        </div>
        
        <div class="form-group">
            <label>Progresas:</label>
            <div class="progress">
                <div class="progress-bar" style="width: {{ status.progress }}%"></div>
            </div>
            <small>{{ status.progress }}% uÅ¾baigta</small>
        </div>
        
        <div class="form-group">
            <label>Dabartinis Å¾ingsnis:</label>
            <p class="current-step">{{ status.current_step }}</p>
        </div>
        
        <script>
            // Auto-refresh every 2 seconds
            setTimeout(function() {
                window.location.reload();
            }, 2000);
        </script>
        
    {% elif status.result %}
        {% if status.result.success %}
            <div class="alert alert-success">
                <strong>âœ… Generavimas sÄ—kmingai uÅ¾baigtas!</strong>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>ğŸ“‚ Rezultatai</h3>
                    <p><strong>Aplankas:</strong> {{ status.result.directory }}</p>
                    <p><strong>Sukurta takeliÅ³:</strong> {{ status.result.tracks_created }}</p>
                    <p><strong>VirÅ¡elis:</strong> {% if status.result.cover_created %}âœ… Sukurtas{% else %}âŒ Nesukurtas{% endif %}</p>
                    
                    {% if status.result.metadata %}
                    <h4>Metadata</h4>
                    <ul>
                        <li><strong>Pavadinimas:</strong> {{ status.result.metadata.title }}</li>
                        <li><strong>Å½anras:</strong> {{ status.result.metadata.genre }}</li>
                        <li><strong>Tema:</strong> {{ status.result.metadata.theme }}</li>
                        <li><strong>ReÅ¾imas:</strong> {{ status.result.metadata.mode }}</li>
                    </ul>
                    {% endif %}
                    
                    <a href="/outputs" class="btn">ğŸ“‚ PerÅ¾iÅ«rÄ—ti Rezultatus</a>
                    <a href="/" class="btn btn-secondary">ğŸ  GrÄ¯Å¾ti</a>
                </div>
            </div>
        {% else %}
            <div class="alert alert-error">
                <strong>âŒ Generavimas nepavyko!</strong><br>
                Klaida: {{ status.result.error or status.error }}
            </div>
            <a href="/" class="btn">ğŸ”„ Bandyti Dar KartÄ…</a>
        {% endif %}
        
    {% else %}
        <div class="alert alert-warning">
            <strong>â„¹ï¸ Generavimas nepradÄ—tas</strong><br>
            Eikite Ä¯ <a href="/">pagrindinÄ¯ puslapÄ¯</a> ir pradÄ—kite generavimÄ….
        </div>
        <a href="/" class="btn">ğŸ  PradÄ—ti GeneravimÄ…</a>
    {% endif %}
</div>

<!-- Logs Section -->
{% if status.logs %}
<div class="card">
    <h2>ğŸ“ Proceso Logai</h2>
    <div class="log-container logs-container">
        {% for log in status.logs %}
        <div class="log-entry">{{ log }}</div>
        {% endfor %}
    </div>
    
    <div style="margin-top: 1rem;">
        <button onclick="document.querySelector('.logs-container').scrollTop = 0" class="btn btn-secondary">â¬†ï¸ Ä® VirÅ¡Å³</button>
        <button onclick="document.querySelector('.logs-container').scrollTop = document.querySelector('.logs-container').scrollHeight" class="btn btn-secondary">â¬‡ï¸ Ä® ApaÄiÄ…</button>
        <button onclick="window.location.reload()" class="btn btn-warning">ğŸ”„ Atnaujinti</button>
    </div>
</div>
{% endif %}

<!-- Controls -->
<div class="card">
    <h2>âš¡ Valdymas</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        {% if not status.running %}
            <a href="/" class="btn">ğŸš€ PradÄ—ti NaujÄ… GeneravimÄ…</a>
        {% endif %}
        <a href="/outputs" class="btn btn-secondary">ğŸ“‚ PerÅ¾iÅ«rÄ—ti Rezultatus</a>
        <button onclick="window.location.reload()" class="btn btn-warning">ğŸ”„ Atnaujinti PuslapÄ¯</button>
    </div>
</div>
{% endblock %}